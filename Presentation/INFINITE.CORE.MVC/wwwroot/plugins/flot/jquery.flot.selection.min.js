!function(T){T.plot.plugins.push({init:function(c){var d={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,currentMode:"xy",active:!1},i=T.plot.uiConstants.SNAPPING_CONSTANT,o={};function n(e){d.active&&(g(e),c.getPlaceholder().trigger("plotselecting",[t()]))}function l(e){var t=c.getOptions();1===e.which&&null!==t.selection.mode&&(d.currentMode="xy",document.body.focus(),void 0!==document.onselectstart&&null==o.onselectstart&&(o.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==o.ondrag&&(o.ondrag=document.ondrag,document.ondrag=function(){return!1}),u(d.first,e),d.active=!0)}function r(e){return void 0!==document.onselectstart&&(document.onselectstart=o.onselectstart),void 0!==document.ondrag&&(document.ondrag=o.ondrag),d.active=!1,g(e),y()?s():(c.getPlaceholder().trigger("plotunselected",[]),c.getPlaceholder().trigger("plotselecting",[null])),!1}function t(){var n,i,l;return y()&&d.show?(n={},i={x:d.first.x,y:d.first.y},l={x:d.second.x,y:d.second.y},"x"===f(c)&&(i.y=0,l.y=c.height()),"y"===f(c)&&(i.x=0,l.x=c.width()),T.each(c.getAxes(),function(e,t){var o;t.used&&(o=t.c2p(i[t.direction]),t=t.c2p(l[t.direction]),n[e]={from:Math.min(o,t),to:Math.max(o,t)})}),n):null}function s(){var e=t();c.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&c.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function a(e,t,o){return t<e?e:o<t?o:t}function f(e){e=e.getOptions();return"smart"===e.selection.mode?d.currentMode:e.selection.mode}function u(e,t){var o=c.getPlaceholder().offset(),n=c.getPlotOffset();e.x=a(0,t.pageX-o.left-n.left,c.width()),e.y=a(0,t.pageY-o.top-n.top,c.height()),e!==d.first&&(t=e,d.first)&&(t={x:t.x-d.first.x,y:t.y-d.first.y},Math.abs(t.x)<i?d.currentMode="y":Math.abs(t.y)<i?d.currentMode="x":d.currentMode="xy"),"y"===f(c)&&(e.x=e===d.first?0:c.width()),"x"===f(c)&&(e.y=e===d.first?0:c.height())}function g(e){null!=e.pageX&&(u(d.second,e),y()?(d.show=!0,c.triggerRedrawOverlay()):h(!0))}function h(e){d.show&&(d.show=!1,d.currentMode="",c.triggerRedrawOverlay(),e||c.getPlaceholder().trigger("plotunselected",[]))}function x(e,t){var o,n,i,l,r,s,a=c.getAxes();for(i in a)if((o=a[i]).direction===t&&e[n=e[n=t+o.n+"axis"]||1!==o.n?n:t+"axis"]){r=e[n].from,s=e[n].to;break}return e[n]||(o=("x"===t?c.getXAxes():c.getYAxes())[0],r=e[t+"1"],s=e[t+"2"]),null!=r&&null!=s&&s<r&&(l=r,r=s,s=l),{from:r,to:s,axis:o}}function y(){var e=c.getOptions().selection.minSize;return Math.abs(d.second.x-d.first.x)>=e&&Math.abs(d.second.y-d.first.y)>=e}c.clearSelection=h,c.setSelection=function(e,t){var o;"y"===f(c)?(d.first.x=0,d.second.x=c.width()):(o=x(e,"x"),d.first.x=o.axis.p2c(o.from),d.second.x=o.axis.p2c(o.to)),"x"===f(c)?(d.first.y=0,d.second.y=c.height()):(o=x(e,"y"),d.first.y=o.axis.p2c(o.from),d.second.y=o.axis.p2c(o.to)),d.show=!0,c.triggerRedrawOverlay(),!t&&y()&&s()},c.getSelection=t,c.hooks.bindEvents.push(function(e,t){null!=e.getOptions().selection.mode&&(e.addEventHandler("dragstart",l,t,0),e.addEventHandler("drag",n,t,0),e.addEventHandler("dragend",r,t,0))}),c.hooks.drawOverlay.push(function(e,t){var o,n,i,l,r,s,a,c;d.show&&y()&&(a=e.getPlotOffset(),i=e.getOptions(),t.save(),t.translate(a.left,a.top),a=T.color.parse(i.selection.color),o=i.selection.visualization,n=i.selection.displaySelectionDecorations,t.strokeStyle=a.scale("a","fill"===o?.8:1).toString(),t.lineWidth=1,t.lineJoin=i.selection.shape,t.fillStyle=a.scale("a",.4).toString(),a=i=Math.min(d.first.x,d.second.x)+.5,c=l=Math.min(d.first.y,d.second.y)+.5,r=Math.abs(d.second.x-d.first.x)-1,s=Math.abs(d.second.y-d.first.y)-1,"x"===f(e)&&(s+=l,l=0),"y"===f(e)&&(r+=i,i=0),"fill"===o?(t.fillRect(i,l,r,s),t.strokeRect(i,l,r,s)):(t.fillRect(0,0,e.width(),e.height()),t.clearRect(i,l,r,s),n&&(o=t,n=i,i=l,l=r,r=s,s=a,a=c,c=f(e),e=Math.max(0,Math.min(15,l/2-2,r/2-2)),o.fillStyle="#ffffff","xy"===c&&(o.beginPath(),o.moveTo(n,i+e),o.lineTo(n-3,i+e),o.lineTo(n-3,i-3),o.lineTo(n+e,i-3),o.lineTo(n+e,i),o.lineTo(n,i),o.closePath(),o.moveTo(n,i+r-e),o.lineTo(n-3,i+r-e),o.lineTo(n-3,i+r+3),o.lineTo(n+e,i+r+3),o.lineTo(n+e,i+r),o.lineTo(n,i+r),o.closePath(),o.moveTo(n+l,i+e),o.lineTo(n+l+3,i+e),o.lineTo(n+l+3,i-3),o.lineTo(n+l-e,i-3),o.lineTo(n+l-e,i),o.lineTo(n+l,i),o.closePath(),o.moveTo(n+l,i+r-e),o.lineTo(n+l+3,i+r-e),o.lineTo(n+l+3,i+r+3),o.lineTo(n+l-e,i+r+3),o.lineTo(n+l-e,i+r),o.lineTo(n+l,i+r),o.closePath(),o.stroke(),o.fill()),n=s,i=a,"x"===c&&(o.beginPath(),o.moveTo(n,i+15),o.lineTo(n,i-15),o.lineTo(n-3,i-15),o.lineTo(n-3,i+15),o.closePath(),o.moveTo(n+l,i+15),o.lineTo(n+l,i-15),o.lineTo(n+l+3,i-15),o.lineTo(n+l+3,i+15),o.closePath(),o.stroke(),o.fill()),"y"===c)&&(o.beginPath(),o.moveTo(n-15,i),o.lineTo(n+15,i),o.lineTo(n+15,i-3),o.lineTo(n-15,i-3),o.closePath(),o.moveTo(n-15,i+r),o.lineTo(n+15,i+r),o.lineTo(n+15,i+r+3),o.lineTo(n-15,i+r+3),o.closePath(),o.stroke(),o.fill())),t.restore())}),c.hooks.shutdown.push(function(e,t){t.unbind("dragstart",l),t.unbind("drag",n),t.unbind("dragend",r)})},options:{selection:{mode:null,visualization:"focus",displaySelectionDecorations:!0,color:"#888888",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);